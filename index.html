<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Fitness</title>
    
    <!-- CONFIGURATION PWA IPHONE -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Fitness">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#020617">

    <!-- NOUVELLE IC√îNE : PNG standard (F blanc sur Noir) pour √©viter le carr√© blanc -->
    <link rel="apple-touch-icon" href="https://ui-avatars.com/api/?name=F&background=020617&color=fff&size=512&font-size=0.6&bold=true&v=10">
    
    <link rel="manifest" href='data:application/json,{"name":"Fitness","short_name":"Fitness","start_url":"index.html","display":"standalone","background_color":"#020617","theme_color":"#020617","id":"fitness-app-v1","icons":[{"src":"https://ui-avatars.com/api/?name=F&background=020617&color=fff&size=512&v=10","sizes":"512x512","type":"image/png"}]}'>

    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap');
        
        :root {
            --bg: #020617;
            --card: #0f172a;
            --text: #f1f5f9;
            --text-dim: #94a3b8;
            --border: #1e293b;
            --accent: #f472b6;
            --input-bg: rgba(255, 255, 255, 0.05);
        }

        .light-mode {
            --bg: #f8fafc;
            --card: #ffffff;
            --text: #0f172a;
            --text-dim: #64748b;
            --border: #e2e8f0;
            --accent: #ec4899;
            --input-bg: rgba(0, 0, 0, 0.05);
        }

        body { 
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg); 
            color: var(--text); 
            transition: background-color 0.3s, color 0.3s;
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior: none;
            height: 100dvh;
            display: flex;
            flex-direction: column;
        }
        
        .bg-card { background-color: var(--card); border: 1px solid var(--border); }
        .text-dim { color: var(--text-dim); }
        
        .tab-active { 
            color: var(--accent) !important; 
            border-bottom: 3px solid var(--accent) !important; 
            opacity: 1 !important; 
        }
        
        .calendar-grid { 
            display: grid; 
            grid-template-columns: repeat(7, 1fr); 
            gap: 6px; 
            max-width: 300px; 
            margin: 0 auto; 
        }
        
        .day-cell { 
            aspect-ratio: 1/1; display: flex; align-items: center; justify-content: center; 
            border-radius: 10px; font-size: 0.7rem; font-weight: 800;
            background: rgba(128, 128, 128, 0.05); border: 1px solid var(--border);
            color: var(--text);
        }
        
        .day-workout { background: linear-gradient(135deg, #34d399 0%, #10b981 100%); color: #064e3b !important; border: none; }
        .day-today { border: 2px solid #38bdf8 !important; color: #38bdf8; }
        .day-selected { background: var(--accent) !important; color: white !important; transform: scale(1.1); z-index: 10; }

        .view-content { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        progress { border-radius: 20px; overflow: hidden; height: 6px; width: 100%; }
        progress::-webkit-progress-bar { background-color: rgba(128,128,128,0.1); }
        #barCals::-webkit-progress-value { background: #38bdf8; }
        #barProt::-webkit-progress-value { background: #34d399; }

        input {
            background-color: var(--input-bg) !important;
            color: var(--text) !important;
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .safe-pt { padding-top: env(safe-area-inset-top); }
    </style>
</head>
<body class="min-h-screen">

    <!-- Header -->
    <header class="bg-card border-b sticky top-0 z-50 safe-pt backdrop-blur-xl">
        <div class="max-w-xl mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center gap-4">
                <div class="w-9 h-9 bg-slate-900 dark:bg-white rounded-xl flex items-center justify-center shadow-lg border border-white/10">
                    <span class="text-white dark:text-slate-900 font-black text-xl italic leading-none">F</span>
                </div>
                <h1 class="text-[12px] font-black tracking-[0.3em] uppercase opacity-60">Fitness</h1>
            </div>
            <div class="flex items-center gap-3">
                <button onclick="toggleTheme()" class="w-9 h-9 flex items-center justify-center rounded-xl bg-slate-500/10 text-lg" id="themeIcon">üåô</button>
                <div class="flex flex-col items-end">
                    <span class="text-[7px] font-black opacity-30 uppercase tracking-widest">S√©rie</span>
                    <span class="text-sm font-black text-orange-500" id="streak-display">0</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation Tab Bar -->
    <nav class="bg-card border-b sticky top-[calc(61px+env(safe-area-inset-top))] z-40 overflow-x-auto no-scrollbar">
        <div class="max-w-xl mx-auto flex px-2 min-w-max justify-around">
            <button onclick="showTab('home', this)" class="nav-btn px-5 py-4 text-[10px] font-black uppercase tracking-[0.1em] tab-active">Focus</button>
            <button onclick="showTab('sport', this)" class="nav-btn px-5 py-4 text-[10px] font-black uppercase tracking-[0.1em] opacity-30">Sport</button>
            <button onclick="showTab('food', this)" class="nav-btn px-5 py-4 text-[10px] font-black uppercase tracking-[0.1em] opacity-30">Food</button>
            <button onclick="showTab('stats', this)" class="nav-btn px-5 py-4 text-[10px] font-black uppercase tracking-[0.1em] opacity-30">Stats</button>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-1 overflow-y-auto max-w-xl mx-auto w-full p-5 pb-32 no-scrollbar">

        <!-- VUE : FOCUS (HOME) -->
        <div id="view-home" class="view-content space-y-6">
            <div class="bg-card p-6 rounded-[2rem] space-y-6 shadow-sm">
                <div class="flex justify-between items-center">
                    <p id="display-date" class="text-[10px] font-black text-sky-500 uppercase italic">Aujourd'hui</p>
                    <button onclick="openGoalModal()" class="text-[9px] font-black opacity-40 uppercase bg-slate-500/5 px-2 py-1 rounded-lg">Objectifs</button>
                </div>
                <div class="space-y-5">
                    <div>
                        <div class="flex justify-between text-[10px] font-black mb-2 uppercase opacity-50 tracking-wider">
                            <span>‚ö° Calories</span>
                            <span id="txt-cals">0 / 2100</span>
                        </div>
                        <progress id="barCals" value="0" max="2100"></progress>
                    </div>
                    <div>
                        <div class="flex justify-between text-[10px] font-black mb-2 uppercase opacity-50 tracking-wider">
                            <span>üçÄ Prot√©ines</span>
                            <span id="txt-prot">0 / 130</span>
                        </div>
                        <progress id="barProt" value="0" max="130"></progress>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div class="bg-card p-6 text-center flex flex-col items-center rounded-[2.5rem]">
                    <span class="text-[8px] font-black opacity-30 uppercase tracking-widest block mb-4">Gourde</span>
                    <p class="text-4xl font-black text-sky-400 mb-5" id="water-count">0</p>
                    <button onclick="addWater()" class="w-full py-3 bg-sky-500/10 text-sky-500 rounded-2xl font-black text-[10px] uppercase active:scale-95 transition-all">Boire</button>
                </div>
                <div class="bg-card p-6 text-center flex flex-col items-center rounded-[2.5rem]">
                    <span class="text-[8px] font-black opacity-30 uppercase tracking-widest block mb-4">Volume</span>
                    <p class="text-4xl font-black text-emerald-400 mb-5" id="vol-count">0</p>
                    <div class="w-full py-3 bg-emerald-500/10 text-emerald-400 rounded-2xl font-black text-[10px] uppercase">Force</div>
                </div>
            </div>

            <div class="bg-card p-6 rounded-[2.5rem] space-y-6">
                <h3 class="text-[10px] font-black opacity-30 uppercase italic">Lifestyle</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div class="space-y-2 text-center">
                        <label class="text-[9px] font-black text-violet-400 uppercase tracking-widest">üí§ Sommeil (h)</label>
                        <input type="number" id="in-sleep" onchange="saveLifestyle('sleep')" placeholder="--" class="w-full p-4 rounded-xl outline-none font-black text-center text-xl">
                    </div>
                    <div class="space-y-2 text-center">
                        <label class="text-[9px] font-black text-orange-400 uppercase tracking-widest">üë£ Pas</label>
                        <input type="number" id="in-steps" onchange="saveLifestyle('steps')" placeholder="--" class="w-full p-4 rounded-xl outline-none font-black text-center text-xl">
                    </div>
                </div>
            </div>

            <div class="bg-card p-6 rounded-[2.5rem] text-center">
                <div class="flex justify-between items-center mb-6 px-2">
                    <button onclick="changeMonth(-1)" class="p-2 opacity-30 text-xl">‚ùÆ</button>
                    <h2 id="month-name" class="font-black text-sm uppercase tracking-widest flex-1 italic">...</h2>
                    <button onclick="changeMonth(1)" class="p-2 opacity-30 text-xl">‚ùØ</button>
                </div>
                <div class="grid grid-cols-7 text-center text-[7px] font-black opacity-20 uppercase mb-4 max-w-[280px] mx-auto">
                    <div>Lu</div><div>Ma</div><div>Me</div><div>Je</div><div>Ve</div><div>Sa</div><div>Di</div>
                </div>
                <div id="calendar-grid" class="calendar-grid"></div>
            </div>
        </div>

        <!-- VUE : SPORT -->
        <div id="view-sport" class="view-content hidden space-y-6">
            <div class="bg-card p-6 rounded-[2.5rem] space-y-6">
                <div class="flex gap-2 p-1 bg-slate-100 dark:bg-slate-800 rounded-2xl">
                    <button id="tab-muscu" class="flex-1 py-3 rounded-xl font-black text-[10px] uppercase bg-slate-900 dark:bg-slate-100 text-white dark:text-slate-900 shadow-sm" onclick="setMode('muscu')">Muscu</button>
                    <button id="tab-cardio" class="flex-1 py-3 rounded-xl font-black text-[10px] uppercase opacity-40" onclick="setMode('cardio')">Cardio</button>
                </div>

                <div id="shortcuts-muscu" class="flex flex-wrap gap-2">
                    <button onclick="setExo('Hip Thrust')" class="px-4 py-2 bg-pink-500/10 text-pink-500 rounded-xl text-[10px] font-black uppercase border border-pink-500/20">üçë Hip Thrust</button>
                    <button onclick="setExo('Squat')" class="px-4 py-2 bg-sky-500/10 text-sky-400 rounded-xl text-[10px] font-black uppercase border border-sky-500/20">üèãÔ∏è Squat</button>
                    <button onclick="setExo('Fentes')" class="px-4 py-2 bg-violet-500/10 text-violet-400 rounded-xl text-[10px] font-black uppercase border border-violet-500/20">üèÉ Fentes</button>
                </div>

                <div id="shortcuts-cardio" class="hidden flex flex-wrap gap-2">
                    <button onclick="setExo('Course')" class="px-4 py-2 bg-orange-500/10 text-orange-400 rounded-xl text-[10px] font-black uppercase border border-orange-500/20">üèÉ Course</button>
                    <button onclick="setExo('V√©lo')" class="px-4 py-2 bg-blue-500/10 text-blue-400 rounded-xl text-[10px] font-black uppercase border border-blue-500/20">üö¥ V√©lo</button>
                </div>

                <input type="text" id="in-exo-name" placeholder="Activit√©/Exercice..." class="w-full p-5 rounded-2xl outline-none font-bold text-sm uppercase italic">
                
                <div id="inputs-muscu" class="flex gap-4">
                    <div class="flex-1">
                        <label class="text-[8px] font-black opacity-30 block mb-2 uppercase text-center">Kg</label>
                        <input type="number" id="in-weight" placeholder="0" class="w-full p-4 rounded-2xl outline-none font-black text-center text-xl">
                    </div>
                    <div class="flex-1">
                        <label class="text-[8px] font-black opacity-30 block mb-2 uppercase text-center">Reps</label>
                        <input type="number" id="in-reps" placeholder="0" class="w-full p-4 rounded-2xl outline-none font-black text-center text-xl">
                    </div>
                </div>
                
                <div id="inputs-cardio" class="hidden flex gap-4">
                    <div class="flex-1">
                        <label class="text-[8px] font-black opacity-30 block mb-2 uppercase text-center">Min</label>
                        <input type="number" id="in-dur" placeholder="0" class="w-full p-4 rounded-2xl outline-none font-black text-center text-xl">
                    </div>
                    <div class="flex-1">
                        <label class="text-[8px] font-black opacity-30 block mb-2 uppercase text-center">Km</label>
                        <input type="number" id="in-dist" step="0.1" placeholder="0" class="w-full p-4 rounded-2xl outline-none font-black text-center text-xl">
                    </div>
                </div>
                
                <button onclick="addWorkoutAction()" class="w-full p-5 bg-pink-500 text-white rounded-3xl font-black uppercase text-xs active:scale-95 transition-all shadow-lg shadow-pink-500/20">ENREGISTRER S√âRIE</button>
            </div>
            <div id="list-sport" class="space-y-4"></div>
        </div>

        <!-- VUE : FOOD -->
        <div id="view-food" class="view-content hidden space-y-6">
            <div class="bg-card p-6 rounded-[2.5rem] space-y-6 border-emerald-500/20">
                <h2 class="text-2xl font-black text-emerald-500 uppercase italic tracking-tighter">Nutrition</h2>
                <div class="flex flex-wrap gap-2">
                    <button onclick="setFood('Poulet', 250, 45)" class="px-4 py-2 bg-emerald-500/10 text-emerald-500 rounded-xl text-[10px] font-black uppercase">üçó Poulet</button>
                    <button onclick="setFood('Shaker', 120, 25)" class="px-4 py-2 bg-emerald-500/10 text-emerald-500 rounded-xl text-[10px] font-black uppercase">ü•§ Shaker</button>
                </div>
                <input type="text" id="in-food-name" placeholder="Aliment..." class="w-full p-5 rounded-2xl outline-none font-bold text-sm uppercase">
                <div class="flex gap-4">
                    <div class="flex-1">
                        <label class="text-[8px] font-black opacity-30 block mb-2 uppercase text-center">Kcal</label>
                        <input type="number" id="in-kcal" placeholder="0" class="w-full p-4 rounded-2xl outline-none font-black text-center text-xl">
                    </div>
                    <div class="flex-1">
                        <label class="text-[8px] font-black opacity-30 block mb-2 uppercase text-center">Prot (g)</label>
                        <input type="number" id="in-prot" placeholder="0" class="w-full p-4 rounded-2xl outline-none font-black text-center text-xl">
                    </div>
                </div>
                <button onclick="addEntry('food')" class="w-full p-5 bg-emerald-500 text-white rounded-3xl font-black uppercase text-xs active:scale-95 shadow-lg shadow-emerald-500/20">AJOUTER AU REPAS</button>
            </div>
            <div id="list-food" class="space-y-4"></div>
        </div>

        <!-- VUE : STATS (MESURES) -->
        <div id="view-stats" class="view-content hidden space-y-6">
            <div class="bg-card p-6 rounded-[2.5rem] space-y-6 text-center">
                <h2 class="font-black text-2xl uppercase italic tracking-tighter">Mesures</h2>
                <div class="space-y-4 text-left">
                    <div class="space-y-2">
                        <label class="text-[9px] font-black opacity-30 block ml-2 uppercase">‚öñÔ∏è Poids actuel (kg)</label>
                        <input type="number" id="in-stat-weight" step="0.1" placeholder="0.0" class="w-full p-5 rounded-[1.5rem] outline-none font-black text-center text-3xl">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="space-y-2">
                            <label class="text-[9px] font-black opacity-30 block ml-2 uppercase text-violet-400">üìè Taille (cm)</label>
                            <input type="number" id="in-stat-waist" placeholder="0" class="w-full p-4 rounded-[1.2rem] outline-none font-black text-center text-xl">
                        </div>
                        <div class="space-y-2">
                            <label class="text-[9px] font-black opacity-30 block ml-2 uppercase text-pink-400">üçë Fessiers (cm)</label>
                            <input type="number" id="in-stat-glutes" placeholder="0" class="w-full p-4 rounded-[1.2rem] outline-none font-black text-center text-xl">
                        </div>
                    </div>
                    <button onclick="saveMeasures()" class="w-full p-5 bg-slate-900 dark:bg-white text-white dark:text-slate-900 rounded-3xl font-black uppercase text-xs shadow-xl active:scale-95 transition-all mt-4">VALIDER LA PES√âE</button>
                </div>
            </div>
            <div id="list-history" class="space-y-3 pb-10"></div>
        </div>

    </main>

    <!-- Modal R√©glages -->
    <div id="modal-goals" class="fixed inset-0 flex items-center justify-center p-6 z-[100] hidden bg-black/80 backdrop-blur-md">
        <div class="bg-card w-full max-w-sm p-8 rounded-[3rem] space-y-8 shadow-2xl border border-white/10">
            <h2 class="text-2xl font-black italic uppercase text-center tracking-widest">Objectifs</h2>
            <div class="space-y-5">
                <div><label class="text-[9px] font-black uppercase opacity-40 ml-4 mb-2 block">Calories Cibles</label><input type="number" id="set-goal-kcal" placeholder="2100" class="w-full p-5 rounded-2xl outline-none font-black text-xl"></div>
                <div><label class="text-[9px] font-black uppercase opacity-40 ml-4 mb-2 block">Prot√©ines Cibles (g)</label><input type="number" id="set-goal-prot" placeholder="130" class="w-full p-5 rounded-2xl outline-none font-black text-xl"></div>
            </div>
            <div class="flex gap-4">
                <button onclick="closeGoalModal()" class="flex-1 p-5 bg-slate-500/10 text-dim rounded-2xl font-black uppercase text-[10px]">Retour</button>
                <button onclick="saveGoals()" class="flex-1 p-5 bg-pink-500 text-white rounded-2xl font-black uppercase text-[10px] shadow-lg shadow-pink-500/30">Valider</button>
            </div>
        </div>
    </div>

    <script>
        let db = { workouts: [], nutrition: [], goals: { kcal: 2100, prot: 130 }, water: {}, history: [], lifestyle: {}, theme: 'dark' };
        const d = new Date(), todayStr = `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
        let selDate = todayStr, calDate = new Date(), curMode = 'muscu';

        function load() {
            const saved = localStorage.getItem('MFP_STRICT_FINAL_v70');
            if(saved) db = JSON.parse(saved);
            if(db.theme === 'light') document.body.classList.add('light-mode');
            updateThemeUI(); refresh();
            const ls = db.lifestyle[selDate] || {};
            document.getElementById('in-sleep').value = ls.sleep || '';
            document.getElementById('in-steps').value = ls.steps || '';
        }

        function save() { localStorage.setItem('MFP_STRICT_FINAL_v70', JSON.stringify(db)); refresh(); }
        
        function refresh() {
            const ws = db.workouts.filter(x => x.date === selDate), ns = db.nutrition.filter(x => x.date === selDate);
            const tk = ns.reduce((s,x) => s + x.kcal, 0), tp = ns.reduce((s,x) => s + x.prot, 0), tv = ws.reduce((s,x) => s + ((x.weight||0) * (x.reps||0)), 0);
            document.getElementById('txt-cals').innerText = `${tk} / ${db.goals.kcal}`;
            document.getElementById('txt-prot').innerText = `${tp} / ${db.goals.prot}`;
            document.getElementById('barCals').value = tk; document.getElementById('barCals').max = db.goals.kcal;
            document.getElementById('barProt').value = tp; document.getElementById('barProt').max = db.goals.prot;
            document.getElementById('water-count').innerText = db.water[selDate] || 0;
            document.getElementById('vol-count').innerText = tv;
            document.getElementById('streak-display').innerText = getStreak();
            renderList('list-sport', ws, 'sport'); renderList('list-food', ns, 'food'); renderHistory(); renderCalendar();
            document.getElementById('display-date').innerText = selDate === todayStr ? "Aujourd'hui" : new Date(selDate).toLocaleDateString('fr-FR', {day:'numeric', month:'long'});
        }

        function renderCalendar() {
            const grid = document.getElementById('calendar-grid'), year = calDate.getFullYear(), month = calDate.getMonth();
            document.getElementById('month-name').innerText = ["Janvier", "F√©vrier", "Mars", "Avril", "Mai", "Juin", "Juillet", "Ao√ªt", "Septembre", "Octobre", "Novembre", "D√©cembre"][month];
            grid.innerHTML = ''; let first = new Date(year, month, 1).getDay(), offset = first === 0 ? 6 : first - 1;
            for(let i=0; i<offset; i++) grid.innerHTML += '<div></div>';
            const days = new Date(year, month + 1, 0).getDate();
            for(let d=1; d<=days; d++) {
                const dc = `${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                const hasW = db.workouts.some(w => w.date === dc);
                let cls = 'day-cell'; if(hasW) cls += ' day-workout';
                if(dc === todayStr) cls += ' day-today'; if(dc === selDate) cls += ' day-selected';
                grid.innerHTML += `<div onclick="selectDate('${dc}')" class="${cls}">${d}</div>`;
            }
        }

        function selectDate(d) { selDate = d; const ls = db.lifestyle[selDate] || {}; document.getElementById('in-sleep').value = ls.sleep || ''; document.getElementById('in-steps').value = ls.steps || ''; refresh(); }
        function changeMonth(v) { calDate.setMonth(calDate.getMonth()+v); renderCalendar(); }
        
        function showTab(id, btn) { 
            document.querySelectorAll('.view-content').forEach(v => v.classList.add('hidden')); 
            document.getElementById('view-'+id).classList.remove('hidden'); 
            document.querySelectorAll('.nav-btn').forEach(b => { b.classList.remove('tab-active'); b.classList.add('opacity-30'); }); 
            btn.classList.add('tab-active'); btn.classList.remove('opacity-30'); 
        }
        
        function setMode(m) {
            curMode = m;
            const isDark = !document.body.classList.contains('light-mode');
            document.getElementById('tab-muscu').className = "flex-1 py-3 rounded-xl font-black text-[10px] uppercase " + (m==='muscu' ? (isDark ? 'bg-white text-slate-900 shadow-sm':'bg-slate-900 text-white shadow-sm') : 'opacity-40');
            document.getElementById('tab-cardio').className = "flex-1 py-3 rounded-xl font-black text-[10px] uppercase " + (m==='cardio' ? (isDark ? 'bg-white text-slate-900 shadow-sm':'bg-slate-900 text-white shadow-sm') : 'opacity-40');
            document.getElementById('inputs-muscu').classList.toggle('hidden', m !== 'muscu');
            document.getElementById('inputs-cardio').classList.toggle('hidden', m !== 'cardio');
            document.getElementById('shortcuts-muscu').classList.toggle('hidden', m !== 'muscu');
            document.getElementById('shortcuts-cardio').classList.toggle('hidden', m !== 'cardio');
        }

        function setExo(n) { document.getElementById('in-exo-name').value = n; }
        function setFood(n,k,p) { document.getElementById('in-food-name').value = n; document.getElementById('in-kcal').value = k; document.getElementById('in-prot').value = p; }
        
        function addWorkoutAction() {
            const n = document.getElementById('in-exo-name').value.trim(); if(!n) return;
            let e = { id: Date.now(), date: selDate, name: n, mode: curMode };
            if(curMode === 'muscu') { e.weight = parseFloat(document.getElementById('in-weight').value) || 0; e.reps = parseInt(document.getElementById('in-reps').value) || 0; }
            else { e.dur = parseInt(document.getElementById('in-dur').value) || 0; e.dist = parseFloat(document.getElementById('in-dist').value) || 0; }
            db.workouts.push(e); save(); document.getElementById('in-exo-name').value = '';
        }

        function addEntry(type) {
            if(type === 'food') {
                const n = document.getElementById('in-food-name').value.trim(), k = parseInt(document.getElementById('in-kcal').value) || 0, p = parseInt(document.getElementById('in-prot').value) || 0;
                if(!n) return; db.nutrition.push({ id: Date.now(), date: selDate, name: n, kcal: k, prot: p }); save(); document.getElementById('in-food-name').value = '';
            }
        }

        function addWater() { const c = db.water[selDate] || 0; db.water[selDate] = c >= 15 ? 0 : c + 1; save(); }
        function saveLifestyle(type) { if(!db.lifestyle[selDate]) db.lifestyle[selDate] = {}; const v = type === 'sleep' ? document.getElementById('in-sleep').value : document.getElementById('in-steps').value; db.lifestyle[selDate][type] = parseFloat(v); save(); }
        
        function saveMeasures() { 
            const w = parseFloat(document.getElementById('in-stat-weight').value); 
            const wa = parseFloat(document.getElementById('in-stat-waist').value);
            const g = parseFloat(document.getElementById('in-stat-glutes').value);
            if(!w && !wa && !g) return; 
            let e = db.history.find(x => x.date === selDate); 
            if(!e) { e = {date: selDate}; db.history.push(e); } 
            if(w) e.w = w; 
            if(wa) e.wa = wa;
            if(g) e.g = g;
            save(); 
            document.getElementById('in-stat-weight').value = '';
            document.getElementById('in-stat-waist').value = '';
            document.getElementById('in-stat-glutes').value = '';
        }

        function renderList(id, items, type) { 
            const el = document.getElementById(id); el.innerHTML = items.length ? '' : '<div class="p-16 text-center opacity-10 font-black uppercase text-[8px] tracking-widest italic">Aucune donn√©e</div>'; 
            [...items].reverse().forEach(i => { 
                const sub = type === 'sport' ? (i.mode === 'muscu' ? `${i.weight}kg √ó ${i.reps}` : `${i.dur}m ‚Ä¢ ${i.dist}km`) : `${i.kcal}kcal ‚Ä¢ ${i.prot}g prot`; 
                el.innerHTML += `<div class="bg-card p-5 rounded-3xl flex justify-between items-center shadow-sm mb-3"><div><p class="font-black text-xs uppercase italic leading-tight">${i.name}</p><p class="text-[8px] font-bold opacity-30 uppercase tracking-widest mt-1">${sub}</p></div><button onclick="delEntry('${type}', ${i.id})" class="p-2 opacity-20">‚úï</button></div>`; 
            }); 
        }

        function delEntry(t, id) { const k = t === 'sport' ? 'workouts' : 'nutrition'; db[k] = db[k].filter(x => x.id !== id); save(); }
        
        function renderHistory() { 
            const el = document.getElementById('list-history'); el.innerHTML = '<h3 class="text-[9px] font-black opacity-20 uppercase tracking-[0.4em] text-center mb-6">Journal de bord</h3>'; 
            const dates = [...new Set([...db.history.map(h=>h.date), ...Object.keys(db.lifestyle)])].sort().reverse().slice(0, 7); 
            dates.forEach(d => { 
                const h = db.history.find(x => x.date === d) || {}, l = db.lifestyle[d] || {}; 
                el.innerHTML += `<div class="bg-card p-5 rounded-3xl flex flex-col gap-3 mb-3">
                    <span class="text-[9px] font-black opacity-30 uppercase tracking-widest">${new Date(d).toLocaleDateString()}</span>
                    <div class="flex flex-wrap gap-4 text-[9px] font-black italic">
                        ${h.w ? `<span class="text-sky-400">‚öñÔ∏è ${h.w}k</span>` : ''}
                        ${h.wa ? `<span class="text-violet-400">üìè T:${h.wa}</span>` : ''}
                        ${h.g ? `<span class="text-pink-500">üçë F:${h.g}</span>` : ''}
                        ${l.steps ? `<span class="text-orange-400">üë£ ${l.steps}</span>` : ''}
                        ${l.sleep ? `<span class="text-violet-500">üí§ ${l.sleep}h</span>` : ''}
                    </div>
                </div>`; 
            }); 
        }
        
        function getStreak() { const dates = [...new Set(db.workouts.map(w => w.date))].sort().reverse(); let s = 0, c = new Date(); if(!dates.includes(todayStr)) c.setDate(c.getDate()-1); for(let i=0; i<365; i++) { const ds = `${c.getFullYear()}-${String(c.getMonth()+1).padStart(2,'0')}-${String(c.getDate()).padStart(2,'0')}`; if(dates.includes(ds)) { s++; c.setDate(c.getDate()-1); } else break; } return s; }
        function toggleTheme() { const isLight = document.body.classList.toggle('light-mode'); db.theme = isLight ? 'light' : 'dark'; updateThemeUI(); save(); }
        function updateThemeUI() { document.getElementById('themeIcon').innerText = db.theme === 'light' ? '‚òÄÔ∏è' : 'üåô'; }
        function openGoalModal() { document.getElementById('modal-goals').classList.remove('hidden'); }
        function closeGoalModal() { document.getElementById('modal-goals').classList.add('hidden'); }
        function saveGoals() { db.goals.kcal = parseInt(document.getElementById('set-goal-kcal').value); db.goals.prot = parseInt(document.getElementById('set-goal-prot').value); save(); closeGoalModal(); }
        function clearAllData() { if(confirm("Effacer tout ?")) { localStorage.clear(); location.reload(); } }
        window.onload = load;
    </script>
</body>
</html>
